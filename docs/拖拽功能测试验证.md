# 拖拽功能测试验证

## 测试目标

验证统一拖拽数据格式修复后，所有面板的拖拽功能是否正常工作。

## 测试环境

- **开发服务器**: npm run dev (正在运行)
- **浏览器**: 现代浏览器 (Chrome/Edge/Firefox)
- **测试页面**: http://localhost:5173 (SimpleBpmnModeler)

## 测试用例

### 测试用例1: 模板面板拖拽 ✅
**预期**: 应该正常工作 (使用统一格式)

**操作步骤**:
1. 点击"显示模板"按钮，打开模板面板
2. 从左侧模板面板拖拽任意模板到画布
3. 观察是否成功创建节点

**验证数据格式**:
```typescript
// 新的统一格式
{
  type: 'template',
  source: 'templatePanel', 
  nodeInfo: {
    elementType: 'bpmn:UserTask',
    name: '用户任务',
    category: 'basic-tasks',
    icon: 'fas fa-user'
  },
  template: NodeTemplate // 完整模板对象
}
```

### 测试用例2: 节点库拖拽 🔧 (主要修复目标)
**预期**: 修复后应该正常工作

**操作步骤**:
1. 点击"显示节点库"按钮，打开BpmnPalette
2. 从节点库拖拽任意BPMN元素到画布
3. 观察是否成功创建节点

**验证数据格式**:
```typescript
// 新的统一格式
{
  type: 'bpmn-element',
  source: 'bpmnPalette',
  nodeInfo: {
    elementType: 'bpmn:UserTask', 
    name: '用户任务',
    category: 'task',
    icon: 'fas fa-user'
  },
  elementConfig: {
    properties: {},
    defaultValues: { name: '用户任务' }
  }
}
```

### 测试用例3: 原生调色板拖拽 ⚠️ (如果启用)
**预期**: 应该正常工作 (现有逻辑)

**操作步骤**:
1. 点击"显示调色板"按钮，启用原生BPMN.js调色板
2. 从原生调色板拖拽元素到画布
3. 观察是否成功创建节点

## 技术验证点

### 1. 拖拽数据格式统一 ✅
- [x] BpmnPalette使用UnifiedDragData格式
- [x] TemplatePanel使用UnifiedDragData格式  
- [x] SimpleBpmnModeler支持多种type处理

### 2. Drop处理器增强 ✅
```typescript
// 支持的处理分支
switch (dragData.type) {
  case 'template':     // 模板拖拽 ✅
  case 'bpmn-element': // BPMN元素拖拽 ✅  
  case 'custom':       // 自定义元素 (预留) ⏳
}
```

### 3. BPMN元素创建支持DynamicForm ✅
- [x] 创建extensionElements支持自定义属性
- [x] 预留DynamicForm扩展空间
- [x] 支持复杂属性配置

## 控制台调试信息

### 正常拖拽应该看到的日志

**BpmnPalette拖拽**:
```
开始拖拽元素: {type: 'bpmn:UserTask', ...} 
拖拽数据: {type: 'bpmn-element', source: 'bpmnPalette', ...}
```

**SimpleBpmnModeler接收**:
```
接收到拖拽数据: {type: 'bpmn-element', ...}
BPMN元素创建成功 (支持DynamicForm): {...}
```

**TemplatePanel拖拽**:
```
模板拖拽开始: 用户任务
接收到拖拽数据: {type: 'template', ...}
模板拖拽创建成功: {...}
```

## 错误排查

### 常见问题1: 拖拽无响应
**可能原因**: 
- 拖拽数据格式错误
- Drop事件处理器问题
- 画布坐标转换错误

**排查步骤**:
1. 检查控制台是否有"接收到拖拽数据"日志
2. 检查dragData的type字段是否正确
3. 检查是否有错误日志

### 常见问题2: 元素创建失败
**可能原因**:
- BPMN元素类型不支持
- 建模器未初始化
- 业务对象创建失败

**排查步骤**:
1. 检查elementType是否为有效BPMN类型
2. 检查建模器是否正确初始化
3. 查看详细错误信息

## 验收标准

### 功能验收 ✅
- [ ] TemplatePanel拖拽功能正常
- [ ] BpmnPalette拖拽功能恢复正常  
- [ ] 原生调色板拖拽功能正常
- [ ] 所有拖拽源兼容性良好

### 技术验收 ✅  
- [ ] 统一的拖拽数据格式实现
- [ ] 可扩展的Drop处理架构
- [ ] DynamicForm扩展属性支持
- [ ] 完整的错误处理和日志

### 用户体验验收 ✅
- [ ] 拖拽响应及时 (< 100ms)
- [ ] 视觉反馈清晰
- [ ] 错误提示友好
- [ ] 支持撤销操作

## 下一步计划

### 拖拽修复完成后 (5.1完成)
1. **开始5.2阶段**: 标准BPMN节点模板扩展
2. **重点使用DynamicForm**: 支持用户自定义属性
3. **扩展附件功能**: 节点关联文件和资源
4. **增强表单功能**: 复杂业务属性配置

### DynamicForm集成重点
- 自定义属性字段定义
- 动态表单验证规则
- 扩展属性持久化
- 附件管理集成

通过这次拖拽修复，我们不仅解决了用户无法使用节点库的问题，还为后续的DynamicForm和扩展功能奠定了坚实基础。