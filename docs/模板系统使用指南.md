# BPMN 节点模板系统使用指南

## 概述

节点模板系统是BPMN建模器的核心功能之一，允许用户创建、管理和重用标准化的流程节点。通过模板系统，可以大大提高建模效率，确保流程的一致性和标准化。

## 功能特性

### 🎯 核心功能
- ✅ **模板创建与管理** - 创建自定义节点模板并进行版本管理
- ✅ **拖拽式建模** - 从模板面板拖拽模板到画布快速创建节点
- ✅ **分类管理** - 按分类组织模板，便于查找和使用
- ✅ **属性继承** - 模板可定义默认属性和配置
- ✅ **版本控制** - 支持模板版本历史和回滚功能
- ✅ **搜索过滤** - 快速搜索和过滤模板
- ✅ **模板应用** - 将模板应用到现有节点

### 🛠 技术特性
- **本地存储** - 模板数据保存在浏览器本地存储中
- **实时同步** - 模板面板与画布实时同步
- **性能优化** - 高效的模板查询和渲染机制

## 界面布局

### 模板面板

模板面板位于建模器左侧，包含以下几个部分：

```
┌─────────────────────────────┐
│     模板面板头部              │
├─────────────────────────────┤
│     搜索和过滤区域            │
├─────────────────────────────┤
│  ┌─ 基础任务 ─────────────┐ │
│  │ 📝 用户任务              │ │
│  │ ⚙️ 服务任务              │ │
│  │ 📜 脚本任务              │ │
│  └─────────────────────────┘ │
│  ┌─ 网关 ─────────────────┐ │
│  │ ⚪ 排他网关              │ │
│  │ ⭕ 包容网关              │ │
│  │ ➕ 并行网关              │ │
│  └─────────────────────────┘ │
│  ┌─ 事件 ─────────────────┐ │
│  │ ▶️ 开始事件              │ │
│  │ ⏹️ 结束事件              │ │
│  └─────────────────────────┘ │
└─────────────────────────────┘
```

### 面板控制按钮

- **➕ 创建模板** - 打开创建模板对话框
- **🔄 刷新** - 重新加载模板数据
- **◀️ 收起** - 收起/展开模板面板

## 基本操作

### 1. 查看和浏览模板

1. **分类浏览**
   - 模板按分类组织（基础任务、网关、事件等）
   - 点击分类头部可展开/收起分类内容
   - 每个分类显示模板数量

2. **模板信息**
   - 模板名称和描述
   - 使用次数统计
   - 最后更新时间

### 2. 搜索和过滤模板

1. **文本搜索**
   ```
   在搜索框中输入关键词，可搜索：
   - 模板名称
   - 模板描述  
   - 模板标签
   ```

2. **分类过滤**
   ```
   选择下拉菜单中的分类：
   - 所有分类
   - 基础任务
   - 网关
   - 事件
   ```

3. **排序选项**
   ```
   - 按名称排序
   - 按使用量排序
   - 按更新时间排序
   ```

### 3. 使用模板创建节点

#### 方法一：拖拽创建（推荐）

1. **选择模板**
   - 从模板列表中找到需要的模板

2. **拖拽到画布**
   - 鼠标按住模板项
   - 拖拽到画布的目标位置
   - 松开鼠标完成创建

3. **确认创建**
   - 新节点会出现在指定位置
   - 自动应用模板的默认属性
   - 节点会关联到源模板

#### 方法二：模板应用

1. **选择已有节点**
   - 在画布中点击选中一个节点

2. **选择模板**
   - 在模板列表中右键点击模板
   - 选择"应用到画布"选项

3. **确认应用**
   - 模板属性会应用到选中的节点
   - 保留节点的原有位置

### 4. 创建自定义模板

1. **打开创建对话框**
   - 点击模板面板右上角的"➕"按钮

2. **填写基础信息**
   ```
   - 模板名称（必填）
   - 模板描述
   - 选择分类（必填）
   - 设置图标
   ```

3. **配置节点类型**
   ```
   选择BPMN节点类型：
   - 任务节点：用户任务、服务任务、脚本任务等
   - 事件节点：开始事件、结束事件、中间事件等
   - 网关节点：排他网关、并行网关、包容网关等
   ```

4. **设置外观配置**
   ```
   - 节点宽度和高度
   - 填充颜色
   - 边框颜色
   - 文字颜色
   ```

5. **配置默认属性**
   ```
   - 添加默认属性键值对
   - 设置是否为默认模板
   - 配置是否允许自定义
   ```

6. **完成创建**
   - 点击"创建模板"按钮
   - 新模板会出现在相应分类中

### 5. 编辑和管理模板

#### 编辑模板

1. **选择模板**
   - 在模板列表中找到要编辑的模板
   - 点击模板右侧的"✏️"编辑按钮

2. **修改配置**
   - 更新模板信息、分类、配置等
   - 修改标签（用逗号分隔）

3. **保存更改**
   - 点击"保存更改"按钮

#### 复制模板

1. **选择模板**
   - 点击模板右侧的"📄"复制按钮

2. **自动创建副本**
   - 系统会创建一个名为"原模板名 (副本)"的新模板
   - 可进一步编辑副本

#### 删除模板

1. **选择模板**
   - 点击模板右侧的"🗑️"删除按钮

2. **确认删除**
   - 系统会要求确认删除操作
   - 删除后无法恢复

### 6. 右键菜单操作

在模板项上右键点击可显示上下文菜单：

```
┌─────────────────┐
│ ✏️ 编辑模板       │
│ 📄 复制模板       │
│ ⭐ 应用到画布     │
├─────────────────┤
│ 📜 版本历史       │
│ 📤 导出模板       │
├─────────────────┤
│ 🗑️ 删除模板       │
└─────────────────┘
```

## 高级功能

### 模板版本管理

系统会自动记录模板的版本信息：
- 创建时间和更新时间
- 作者信息
- 使用次数统计
- 版本历史记录

### 模板属性继承

当从模板创建节点时，会自动继承：
- 模板定义的默认属性
- 节点类型特定的配置
- UI外观设置

### 智能位置调整

拖拽创建节点时，系统会：
- 检测位置冲突
- 自动调整位置避免重叠
- 保持合理的间距

## 最佳实践

### 1. 模板命名规范

```
建议的命名方式：
- 用户任务 - 审批流程
- 服务任务 - 数据验证
- 排他网关 - 条件判断
```

### 2. 分类组织

```
推荐的分类结构：
- 基础任务（通用任务节点）
- 业务任务（特定业务场景）
- 网关决策（各类网关节点）
- 事件处理（事件相关节点）
- 自定义节点（特殊定制节点）
```

### 3. 属性设计

```
合理的默认属性设置：
- 必要的标识信息
- 常用的配置选项
- 合适的默认值
- 清晰的描述信息
```

### 4. 版本控制

```
版本管理建议：
- 重大变更时创建新版本
- 保留变更日志
- 定期清理旧版本
- 备份重要模板
```

## 故障排除

### 常见问题

1. **模板拖拽无效**
   ```
   原因：画布未完全加载或模板数据损坏
   解决：刷新页面或重新加载模板
   ```

2. **模板属性未生效**
   ```
   原因：属性冲突或类型不匹配
   解决：检查属性配置和节点类型兼容性
   ```

3. **模板搜索无结果**
   ```
   原因：搜索关键词不匹配或数据未加载
   解决：检查关键词拼写或刷新模板数据
   ```

### 性能优化

1. **大量模板时**
   - 使用分类和搜索功能
   - 定期清理不用的模板
   - 考虑模板分组管理

2. **创建复杂模板时**
   - 分步骤进行配置
   - 及时保存草稿
   - 测试模板功能

## 技术架构

### 核心组件

- **TemplateManager** - 模板管理核心类
- **TemplatePanel** - 模板面板组件
- **TemplateDropHandler** - 拖拽处理器
- **TemplateCreateDialog** - 创建对话框
- **TemplateEditDialog** - 编辑对话框

### 数据流程

```
用户操作 → 模板面板 → TemplateManager → 本地存储
                ↓
拖拽事件 → DropHandler → BPMN画布 → 节点创建
```

### 存储机制

模板数据存储在浏览器的localStorage中：
- `bpmn-templates` - 模板数据
- `bpmn-template-categories` - 分类数据

## 总结

节点模板系统为BPMN建模提供了强大的复用和标准化能力。通过合理使用模板功能，可以：

- 📈 **提高效率** - 快速创建标准化节点
- 🎯 **保证质量** - 避免配置错误和遗漏
- 🔄 **促进重用** - 积累和分享最佳实践
- 📊 **便于管理** - 集中管理常用节点配置

建议用户根据实际业务需求，逐步建立完善的模板库，以提升整体的建模效率和质量。