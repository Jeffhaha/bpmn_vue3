# Phase 5.2.1 事件模板扩展测试验证脚本

## 自动化测试命令

### 1. 快速验证开发环境

```bash
# 确保开发服务器运行
npm run dev

# 检查模板文件是否存在
ls -la src/utils/template-packages/event-templates.ts

# 检查文件大小和内容
wc -l src/utils/template-packages/event-templates.ts
```

### 2. 浏览器测试步骤 (5分钟完整验证)

#### 步骤1: 打开应用并检查控制台 (1分钟)
1. 打开 http://localhost:5173
2. 按F12打开开发者工具
3. 查看控制台，寻找以下关键日志：
   ```
   ✅ "开始加载事件模板包... 25 个模板"
   ✅ "事件模板包加载完成 - 已创建 25 个事件模板"  
   ✅ "完整的默认模板库创建完成 - 已加载任务模板(7个) + 事件模板(25个) + 网关模板(4个) = 共36个BPMN模板"
   ```

#### 步骤2: 验证模板面板 (1分钟)
1. 点击工具栏 **"显示模板"** 按钮
2. 模板面板在左侧展开
3. 查找 **"事件"** 分类，点击展开
4. 确认显示 **(25)** 个模板
5. 滚动查看所有模板类型

#### 步骤3: 测试搜索和过滤功能 (1分钟)
1. 在搜索框输入 **"消息"**
2. 确认筛选出所有消息相关事件
3. 清空搜索，选择分类过滤 **"事件"**
4. 切换排序方式测试

#### 步骤4: 拖拽功能测试 (2分钟)
1. **开始事件测试**:
   - 拖拽 "空开始事件" 到画布
   - 拖拽 "消息开始事件" 到画布
   - 拖拽 "定时开始事件" 到画布

2. **中间事件测试**:
   - 拖拽 "定时中间事件" 到画布
   - 拖拽 "消息中间捕获事件" 到画布

3. **结束事件测试**:
   - 拖拽 "空结束事件" 到画布
   - 拖拽 "错误结束事件" 到画布

4. **验证创建成功**:
   - 每次拖拽后检查控制台日志
   - 确认显示: `BPMN元素创建成功 (支持DynamicForm)`

## 预期测试结果

### ✅ 成功标准

1. **模板数量正确**: 事件分类显示25个模板
2. **拖拽功能正常**: 所有事件都能成功拖拽到画布
3. **控制台无错误**: 没有红色错误信息
4. **DynamicForm支持**: 创建的元素包含extensionElements
5. **分类显示正确**: 9个开始事件 + 12个中间事件 + 4个结束事件 = 25个

### ❌ 失败标准

1. **模板加载失败**: 控制台显示加载错误
2. **拖拽无响应**: 拖拽后没有创建元素
3. **模板数量不对**: 事件分类不是25个模板
4. **分类错误**: 模板出现在错误的分类中

## 高级测试 (可选)

### 1. 控制台验证模板数据

在浏览器控制台执行：

```javascript
// 检查模板管理器状态
console.log('模板总数:', window.__bpmn_template_manager?.getAllTemplates().length)

// 检查事件模板
const eventTemplates = window.__bpmn_template_manager?.getTemplatesByCategory('events')
console.log('事件模板数量:', eventTemplates?.length)
console.log('事件模板列表:', eventTemplates?.map(t => t.name))

// 检查DynamicForm配置
const messageStartEvent = eventTemplates?.find(t => t.name === '消息开始事件')
console.log('消息开始事件DynamicForm配置:', messageStartEvent?.properties.dynamicFormConfig)
```

### 2. 属性面板测试

1. **选择事件节点**:
   - 点击画布上的任一事件节点
   - 右侧属性面板应显示属性

2. **检查扩展属性**:
   - 查看是否有自定义属性字段
   - 验证DynamicForm表单是否正确加载

### 3. 性能测试

1. **加载时间**: 模板加载应在1秒内完成
2. **拖拽响应**: 拖拽操作应无明显延迟
3. **内存使用**: 检查浏览器内存使用是否合理

## 故障排除检查表

### 如果模板数量不正确:

- [ ] 检查 `/src/utils/template-packages/event-templates.ts` 文件是否存在
- [ ] 验证事件模板包的导出函数 `getAllEventTemplates`
- [ ] 查看控制台是否有导入错误

### 如果拖拽不工作:

- [ ] 检查 `UnifiedDragData` 格式是否正确
- [ ] 验证 `SimpleBpmnModeler.vue` 的 `handleDrop` 方法
- [ ] 确认BPMN建模器已正确初始化

### 如果DynamicForm不生效:

- [ ] 检查模板的 `properties.dynamicFormConfig` 配置
- [ ] 验证元素创建时的 `extensionElements`
- [ ] 确认属性面板支持DynamicForm

## 测试报告模板

### 测试环境
- 浏览器: ___________
- Node.js版本: ___________
- 项目版本: Phase 5.2.1

### 测试结果

| 测试项目 | 状态 | 备注 |
|---------|------|------|
| 模板加载 | ✅/❌ | |
| 模板数量 (25个) | ✅/❌ | |
| 开始事件 (9个) | ✅/❌ | |
| 中间事件 (12个) | ✅/❌ | |  
| 结束事件 (4个) | ✅/❌ | |
| 拖拽功能 | ✅/❌ | |
| 搜索过滤 | ✅/❌ | |
| DynamicForm支持 | ✅/❌ | |
| 控制台无错误 | ✅/❌ | |

### 问题记录
_在此记录测试过程中发现的问题_

### 改进建议  
_测试完成后的功能改进建议_

---

## 下一阶段准备

完成5.2.1测试后，为5.2.2做准备：

1. **确认当前任务模板**: 验证现有7个任务模板
2. **规划任务扩展**: 准备扩展到15个任务模板
3. **DynamicForm经验**: 总结事件模板的DynamicForm使用经验

测试愉快！🎉